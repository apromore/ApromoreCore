<?xml version="1.0" encoding="utf-8"?>
<!--
  ~ Copyright Â© 2009-2018 The Apromore Initiative.
  ~
  ~ This file is part of "Apromore".
  ~
  ~ "Apromore" is free software; you can redistribute it and/or modify
  ~ it under the terms of the GNU Lesser General Public License as
  ~ published by the Free Software Foundation; either version 3 of the
  ~ License, or (at your option) any later version.
  ~
  ~ "Apromore" is distributed in the hope that it will be useful, but
  ~ WITHOUT ANY WARRANTY; without even the implied warranty
  ~ of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
  ~ See the GNU Lesser General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Lesser General Public
  ~ License along with this program.
  ~ If not, see <http://www.gnu.org/licenses/lgpl-3.0.html>.
  -->

<project>
    <description>Student distribution</description>
    <fileset id="pickupRepo-student" dir=".">
        <include name="Apromore-Assembly/Manager-Assembly/src/main/resources/100-manager.plan"/>
        <include name="Apromore-Assembly/Portal-Assembly/src/main/resources/101-portal.plan"/>
        <include name="Apromore-Assembly/Filestore-Assembly/src/main/resources/102-filestore.plan"/>
        <include name="Apromore-Assembly/Editor-Assembly/src/main/resources/104-editor-student.plan"/>
                
        <include name="Apromore-Assembly/Custom-Plugins/custom-plugins-ce.plan"/>

        <include name="Apromore-Custom-Plugins/Account-Portal-Plugin/target/account-portal-plugin-1.0.jar"/>

        <include name="Apromore-Custom-Plugins/BIMP-Annotation-Logic/target/bimp-annotation-logic-1.0.jar"/>
        <include name="Apromore-Custom-Plugins/BIMP-Editor-Plugin/target/bimp-editor-plugin-1.0.war"/>
        <include name="Apromore-Custom-Plugins/BIMP-Portal-Plugin/target/bimp-portal-plugin-1.0.jar"/>

        <include name="Apromore-Custom-Plugins/BPMNDiagramImporter-Logic/target/bpmndiagramimporter-logic-1.1.jar"/>

        <include name="Apromore-Custom-Plugins/Cmapper-Portal-Plugin/target/cmapper-portal-plugin-1.1.war"/>

        <!-- BPMNMiner renamed ~BPMNMiner elsewhere as a workaround for its dependency on IBPStruct
        <include name="Apromore-Custom-Plugins/BPMNMiner-Logic/target/bpmnminer-logic-1.1.jar"/>
        <include name="Apromore-Custom-Plugins/BPMNMiner-Portal-Plugin/target/bpmnminer-portal-plugin-1.1.jar"/>
        -->

        <include name="Apromore-Custom-Plugins/Compare-Logic/target/compare-logic-1.1.jar"/>
        <!--Switch off Signavio-based plugins <include name="Apromore-Custom-Plugins/Compare-Portal-Plugin/target/compareBP-portal-plugin-1.1.war"/>-->

        <include name="Apromore-Custom-Plugins/LTL-Conf-Logic/target/ltl-conf-logic-1.1.jar"/>
        <include name="Apromore-Custom-Plugins/LTL-Conf-Portal-Plugin/target/ltl-conf-portal-plugin-1.1.war"/>
        
        <include name="Apromore-Custom-Plugins/APM-Logic/target/apm-logic-1.1.jar"/>
        <include name="Apromore-Custom-Plugins/APM-Portal-Plugin/target/apm-portal-plugin-1.1.war"/>

        <include name="Apromore-Custom-Plugins/APM-Compliance-Logic/target/apm-compliance-logic-1.1.jar"/>
        <include name="Apromore-Custom-Plugins/APM-Compliance-Portal-Plugin/target/apm-compliance-portal-plugin-1.1.war"/>

        <include name="Apromore-Custom-Plugins/APM-Comp-Guards-Logic/target/apm-comp-guards-logic-1.1.jar"/>
        <include name="Apromore-Custom-Plugins/APM-Comp-Guards-Portal-Plugin/target/apm-comp-guards-portal-plugin-1.1.war"/>

        <include name="Apromore-Custom-Plugins/IBPStruct-Logic/target/ibpstruct-logic-1.1.jar"/>
        <include name="Apromore-Custom-Plugins/IBPStruct-Portal-Plugin/target/ibpstruct-portal-plugin-1.1.jar"/>
        <!-- ibpstruct-editor-plugin renamed ~ibpstruct-editor-plugin elsewhere as a workaround for its dependency upon ibpstruct-logic
        <include name="Apromore-Plugins/plugin-editor/ibpstruct/target/ibpstruct-editor-plugin-1.1.war"/>
        -->

        <include name="Apromore-Custom-Plugins/Activity-Filter-Logic/target/activity-filter-logic-1.1.jar"/>
        <include name="Apromore-Custom-Plugins/Activity-Filter-Portal-Plugin/target/activity-filter-portal-plugin-1.1.jar"/>

        <include name="Apromore-Custom-Plugins/Infrequent-Behaviour-Filter-Logic/target/infrequent-behaviour-filter-logic-1.1.jar"/>
        <include name="Apromore-Custom-Plugins/Infrequent-Behaviour-Filter-Portal-Plugin/target/infrequent-behaviour-filter-portal-plugin-1.1.jar"/>

        <include name="Apromore-Custom-Plugins/Predictive-Monitor-Logic/target/predictive-monitor-logic-1.0.jar"/>
        <include name="Apromore-Custom-Plugins/Predictive-Monitor-Portal-Plugin/target/predictive-monitor-portal-plugin-1.0.war"/>
        <include name="Apromore-Custom-Plugins/Predictor-Training-Portal-Plugin/target/predictor-training-portal-plugin-1.0.war"/>

        <include name="Apromore-Custom-Plugins/Log-Animation-Logic/target/log-animation-logic-1.0.jar"/>


        <!-- Do not switch off this Signavio-based plugin because Process Discoverer depends on it -->
        <include name="Apromore-Custom-Plugins/Log-Animation-Portal-Plugin/target/log-animation-portal-plugin-1.0.war"/>
        
        <!-- <include name="Apromore-Custom-Plugins/Log-Visualizer-Logic/target/log-visualizer-logic-1.1.jar"/> -->
        <!-- <include name="Apromore-Custom-Plugins/Log-Visualizer-Logic-WS/target/log-visualizer-logic-ws-1.1.war"/> -->
        <!-- <include name="Apromore-Custom-Plugins/Log-Visualizer-Portal-Plugin/target/log-visualizer-portal-plugin-1.1.jar"/> -->

        <include name="Apromore-Custom-Plugins/Metrics-Logic/target/metrics-logic-1.1.jar"/>
        <include name="Apromore-Custom-Plugins/Metrics-Portal-Plugin/target/metrics-portal-plugin-1.1.jar"/>

        <include name="Apromore-Custom-Plugins/BEBoP-Logic/target/gbebop-logic-1.1.jar"/>
        <include name="Apromore-Custom-Plugins/BEBoP-Portal-Plugin/target/gbebop-portal-plugin-1.1.jar"/>

        <include name="Apromore-Custom-Plugins/BProVe-Logic/target/gbprove-logic-1.1.jar"/>

        <include name="Apromore-Custom-Plugins/PerformanceMiner-Logic/target/perfmining-logic-1.0.jar"/>
        <include name="Apromore-Custom-Plugins/PerformanceMiner-Portal-Plugin/target/perfmining-portal-plugin-1.0.jar"/>

        <!-- logfilter-editor-plugin renamed ~logfilter-editor-plugin elsewhere as a workaround for its dependency upon logfilter-logic
        <include name="Apromore-Plugins/plugin-editor/logfilter/target/logfilter-editor-plugin-1.1.war"/>
        -->

        <include name="Apromore-Custom-Plugins/ProDrift-Logic/target/prodrift-logic-1.1.jar"/>
        <include name="Apromore-Custom-Plugins/ProDrift-Portal-Plugin/target/prodrift-portal-plugin-1.1.jar"/>

        <include name="Apromore-Custom-Plugins/Quaestio-Portal-Plugin/target/quaestio-portal-plugin-1.1.war"/>

        <!-- <include name="Apromore-Custom-Plugins/Similarity-Clusters-Portal-Plugin/target/similarity-clusters-portal-plugin-1.1.jar"/> -->

        <include name="Apromore-Custom-Plugins/StageMining-Logic/target/stagemining-logic-1.1.jar"/>
        <include name="Apromore-Custom-Plugins/StageMining-Portal-Plugin/target/stagemining-portal-plugin-1.1.jar"/>
        
        <include name="Apromore-Custom-Plugins/Process-Discoverer-Logic/target/process-discoverer-logic-2.0.0.jar"/>
        <include name="Apromore-Custom-Plugins/Process-Discoverer-Portal-Plugin/target/process-discoverer-portal-plugin-2.0.0.war"/>

        <!--
        <include name="Supplements/ow2-bundles-externals-opencsv-1.0.36.jar"/>
        <include name="Supplements/process-discoverer-1.0.20181204.jar"/>
        -->

        <!-- After creating the PQL tables in MySQL, uncomment these components to enable PQL indexing and querying
        <include name="Apromore-Custom-Plugins/APQL-Portal-Plugin/target/apql-portal-plugin-1.1.war"/>
        <include name="Apromore-Assembly/PQL-Indexer-Assembly/src/main/resources/103-pql-indexer.plan"/>
        <include name="Apromore-Custom-Plugins/PQL-Logic/target/pql-logic-1.1.jar"/>
        <include name="Apromore-Custom-Plugins/PQL-Logic-WS/target/pql-logic-ws-1.1.war"/>
        <include name="Apromore-Custom-Plugins/PQL-Portal-Plugin/target/pql-portal-plugin-1.1.jar"/>
        -->

        <include name="Apromore-Core-Components/Apromore-BPMNEditor/target/apromore-bpmneditor-1.1.war"/>
        <include name="Apromore-Custom-Plugins/Compare-Portal-Plugin2/target/compareBP-portal-plugin2-1.1.war"/>
        <include name="Apromore-Custom-Plugins/BIMP-Editor-Plugin2/target/bimp-editor-plugin2-1.0.war"/>
        <!-- <include name="Apromore-Custom-Plugins/Log-Animation-Portal-Plugin2/target/log-animation-portal-plugin2-1.0.war"/> -->
    </fileset>

    <target name="start-virgo-student" depends="deploy-virgo-student">
        <exec dir="${dir-virgo}/bin/" executable="cmd" osfamily="windows">
            <arg value="/c"/>
            <arg value="startup.bat"/>
            <arg line="-clean"/>
        </exec>
        <exec dir="${dir-virgo}/bin/" executable="./startup.sh" osfamily="unix">
            <arg line="-clean"/>
        </exec>
    </target>
    
    <target name="deploy-virgo-student" depends="clean-virgo, setup-virgo, copy-virgo-student"/>
    
    <target name="copy-virgo-student" depends="clean-virgo, create-repository-dirs">
            <copy file="Supplements/liblpsolve55.jnilib" tofile="${dir-virgo}/liblpsolve55.jnilib" overwrite="true"/>
            <copy file="Supplements/liblpsolve55.lib" tofile="${dir-virgo}/liblpsolve55.lib" overwrite="true"/>
            <copy file="Supplements/liblpsolve55d.lib" tofile="${dir-virgo}/liblpsolve55d.lib" overwrite="true"/>
            <copy file="Supplements/liblpsolve55j.jnilib" tofile="${dir-virgo}/liblpsolve55j.jnilib" overwrite="true"/>
            <copy file="Supplements/lpsolve55.lib" tofile="${dir-virgo}/lpsolve55.lib" overwrite="true"/>
            <copy file="Supplements/lpsolve55.dll" tofile="${dir-virgo}/lpsolve55.dll" overwrite="true"/>
            <copy file="Supplements/lpsolve55j.dll" tofile="${dir-virgo}/lpsolve55j.dll" overwrite="true"/>

            <copy todir="${dir-virgo}/repository/usr" flatten="true" overwrite="true">
                <fileset dir="${dir-osgi}">
                    <include name="**/target/eclipse-collections-osgi-1.1.jar"/>
                    <include name="**/target/bpmntk-osgi-1.1.jar"/>
                    <include name="**/target/similaritysearch-osgi-1.1.jar"/>
                    <include name="**/target/eventstr-confchecking-osgi-1.1.jar"/>
                    <include name="**/target/apm-verification-osgi-1.1.jar"/>
    <!--                <include name="**/target/uma-bpdiff-osgi-1.1.jar"/>-->
                    <include name="**/target/pn-automata-conv-osgi-1.1.jar"/>
                    <include name="**/target/prom-pnml-osgi-1.1.jar"/>
                    <include name="**/target/ltl-to-automaton-osgi-1.1.jar"/>
                    <include name="**/target/declare-visualizer-osgi-1.1.jar"/>
                    <!--<include name="**/target/pnapi-bpdiff-osgi-1.1.jar"/>-->
                    <include name="**/target/raffaeleconforti-osgi-1.1.jar"/>
                    <include name="**/target/ltl-conf-check-osgi-1.1.jar"/>
                    <!-- the PQL subsystem will add this, so it normally won't need to be done explicitly
                    <include name="**/target/json-osgi-20090211.jar"/>
                    -->
                </fileset>

                <!-- This bundle is a dependency for the eventstr-confchecking-code-osgi bundle, which is in turn used by Compare-Logic -->
                <fileset dir="Supplements/">
                    <include name="org.apache.servicemix.bundles.gwt-dev-2.6.0_1.jar"/>
                </fileset>
            </copy>
            <copy todir="${dir-virgo}/repository/usr" flatten="true" overwrite="true">
                <fileset refid="usrRepo"/>
            </copy>
            <copy todir="${dir-virgo}/pickup" flatten="true" overwrite="true">
                <fileset refid="pickupRepo-student"/>
            </copy>

            <!-- Force the BPMN Miner plugin to be alphabetically after the iBPStruct plugin it depends upon -->
            <copy file="Apromore-Custom-Plugins/BPMNMiner-Logic/target/bpmnminer-logic-1.1.jar" tofile="${dir-virgo}/pickup/~bpmnminer-logic-1.1.jar"/>
            <copy file="Apromore-Custom-Plugins/BPMNMiner-Portal-Plugin/target/bpmnminer-portal-plugin-1.1.jar" tofile="${dir-virgo}/pickup/~bpmnminer-portal-plugin-1.1.jar"/>

            <!-- Force the editor plugins to be alphabetically after the logic plugins they depends upon -->
            <copy file="Apromore-Plugins/plugin-editor/metrics2/target/metrics-editor-plugin2-1.1.war" tofile="${dir-virgo}/pickup/~metrics-editor-plugin2-1.1.war"/>
            <!-- Switch off Signavio-based plugins
            <copy file="Apromore-Plugins/plugin-editor/ibpstruct/target/ibpstruct-editor-plugin-1.1.war" tofile="${dir-virgo}/pickup/~ibpstruct-editor-plugin-1.1.war"/>
            <copy file="Apromore-Plugins/plugin-editor/metrics/target/metrics-editor-plugin-1.1.war" tofile="${dir-virgo}/pickup/~metrics-editor-plugin-1.1.war"/>
            <copy file="Apromore-Plugins/plugin-editor/bebop/target/gbebop-editor-plugin-1.1.war" tofile="${dir-virgo}/pickup/~gbebop-editor-plugin-1.1.war"/>
            <copy file="Apromore-Plugins/plugin-editor/bprove/target/gbprove-editor-plugin-1.1.war" tofile="${dir-virgo}/pickup/~gbprove-editor-plugin-1.1.war"/>
            -->

            <!-- After creating the PQL tables in MySQL, uncomment this component to enable PQL indexing
            <copy file="Apromore-Custom-Plugins/PQL-Indexer-Portal-Plugin/target/pql-indexer-portal-plugin-1.1.jar" tofile="${dir-virgo}/pickup/~pql-indexer-portal-plugin-1.1.jar"/>
            -->

            <copy todir="${dir-virgo}/pickup" flatten="true" overwrite="true">
                <fileset dir="${dir-annotation}">
                    <include name="**/target/*.jar"/>
                    <exclude name="**/target/*-sources.jar"/>
                    <exclude name="**/core/**/*.jar"/>
                </fileset>
                <fileset dir="${dir-canoniser}">
                    <include name="**/target/*.jar"/>
                    <exclude name="**/target/*-sources.jar"/>
                    <exclude name="**/core/**/*.jar"/>
                </fileset>
                <!--<fileset dir="${dir-portal-templates}">-->
                    <!--<include name="**/target/*.jar"/>-->
                    <!--<exclude name="**/target/*-sources.jar"/>-->
                    <!--<exclude name="**/core/**/*.jar"/>-->
                <!--</fileset>-->
                <fileset dir="${dir-logic-plugins}">
                    <include name="**/target/*.jar"/>
                    <exclude name="**/target/*-sources.jar"/>
                    <exclude name="**/core/**/*.jar"/>
                </fileset>
                <fileset dir="${dir-portal-plugins}">
                    <include name="**/target/*.jar"/>
                    <exclude name="**/target/*-sources.jar"/>
                    <exclude name="**/core/**/*.jar"/>
                    <exclude name="sample/target/*.jar"/>
                </fileset>
                <!--
                <fileset dir="${dir-editor-plugins}">
                    <include name="**/target/*.war"/>
                    <exclude name="**/target/*-sources.jar"/>
                    <exclude name="**/core/**/*.jar"/>
                </fileset>
                -->
                <!--<fileset dir="${dir-deploy}">-->
                    <!--<include name="**/target/*.jar"/>-->
                    <!--<exclude name="**/target/*-sources.jar"/>-->
                    <!--<exclude name="**/core/**/*.jar"/>-->
                <!--</fileset>-->
            </copy>

            <!-- PQL indexing bot -->
            <copy file="Apromore-Extras/PQLBot/target/pql-bot-1.2.one-jar.jar" tofile="${dir-virgo}/pql-bot.jar" overwrite="true"/>
    </target>
    
</project>
