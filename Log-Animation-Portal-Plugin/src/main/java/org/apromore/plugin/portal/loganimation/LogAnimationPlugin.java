/*
 * Copyright Â© 2009-2018 The Apromore Initiative.
 *
 * This file is part of "Apromore".
 *
 * "Apromore" is free software; you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 3 of the
 * License, or (at your option) any later version.
 *
 * "Apromore" is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty
 * of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 * See the GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this program.
 * If not, see <http://www.gnu.org/licenses/lgpl-3.0.html>.
 */

package org.apromore.plugin.portal.loganimation;

// Java 2 Standard Edition
import java.util.*;

// Java 2 Enterprise Edition
import javax.inject.Inject;

// Third party packages
import org.apromore.manager.client.ManagerService;
import org.apromore.model.*;
import org.deckfour.xes.model.XLog;
import org.springframework.stereotype.Component;
import org.zkoss.zk.ui.util.Clients;
import org.zkoss.zul.Messagebox;

// Local packages
import org.apromore.exception.RepositoryException;
import org.apromore.helper.Version;
import org.apromore.plugin.portal.DefaultPortalPlugin;
import org.apromore.plugin.portal.PortalContext;
import org.apromore.plugin.property.RequestParameterType;
import org.apromore.portal.common.UserSessionManager;
import org.apromore.portal.dialogController.dto.SignavioSession;
import org.apromore.service.EventLogService;
import org.apromore.service.ProcessService;
import org.apromore.service.loganimation.LogAnimationService;

@Component("plugin")
public class LogAnimationPlugin extends DefaultPortalPlugin implements LogAnimationPluginInterface {

    public static void main(String[] args) {

        String bpmnModel = "<?xml version=\"1.0\" encoding=\"UTF-8\"?> <definitions xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\"  xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\"  xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\"  xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\"  xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"  targetNamespace=\"http://www.omg.org/bpmn20\"  xsi:schemaLocation=\"http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd\"><process id=\"proc_11500656\"> <startEvent id=\"node_608c9ab1-1df4-4957-88cb-228ba60cabe3\" name=\"|&gt;\" isInterrupting=\"false\"/> <endEvent id=\"node_27d3ecb2-fa4f-46e4-9f1b-f9313610ef01\" name=\"[]\" isInterrupting=\"false\"/> <task id=\"node_c3998c0b-4472-47ae-ae33-9e83f3ce03cd\" name=\"Amend Purchase Requisition\"/> <task id=\"node_e22a1a5c-9d80-45f5-aa2a-9b484e1b941f\" name=\"Analyze Request for Quotation\"/> <task id=\"node_db5ccef7-17e2-47a8-8990-074f4f9f2331\" name=\"Choose best option\"/> <task id=\"node_8d4e67ae-07df-4fae-880c-599ee93c2fd2\" name=\"Settle conditions with supplier\"/> <task id=\"node_4da14501-1f17-4982-9af7-152b82ca3049\" name=\"Create Purchase Requisition\"/> <task id=\"node_0690953b-b3b7-4ecc-bd55-734b49b632cc\" name=\"Send Request for Quotation to Supplier\"/> <task id=\"node_2570cd59-8515-4875-a859-7bd3d59aa1b5\" name=\"Analyze Purchase Requisition\"/> <task id=\"node_dc448366-b458-40e4-8d5c-8617031e2f78\" name=\"Settle dispute with supplier Financial Manager\"/> <task id=\"node_16639e84-f9d2-4ae7-b20b-d12de4012a10\" name=\"Authorize Supplier\\u0027s Invoice payment\"/> <task id=\"node_8b895566-e2cb-4b59-8289-188758953e5c\" name=\"Release Supplier\\u0027s Invoice\"/> <task id=\"node_e34db94d-833f-4db5-8f1e-db1fcd6a91b7\" name=\"Confirm Purchase Order\"/> <task id=\"node_b33ea688-0858-4332-a0cc-d8f2f847e964\" name=\"Deliver Goods Services\"/> <task id=\"node_4e061e76-de3f-44a8-bf33-d0027841b401\" name=\"Create Quotation comparison Map\"/> <task id=\"node_24b7edee-5b62-4e38-a101-25c4f3e353e6\" name=\"Approve Purchase Order for payment\"/> <task id=\"node_7a050268-19a8-41a9-88fa-58215d9755d0\" name=\"Release Purchase Order\"/> <task id=\"node_bd0945ae-f3c2-4251-8f84-0ba0f55fa1d3\" name=\"Create Purchase Order\"/> <task id=\"node_58f25b2e-df26-4456-a9d8-57eb6ca96144\" name=\"Pay invoice\"/> <task id=\"node_a5c2f628-1bbf-41c1-b02e-c16bec96b3b6\" name=\"Create Request for Quotation Requester Manager\"/> <task id=\"node_26d059dd-ce9a-4def-8337-4feb4573c247\" name=\"Settle dispute with supplier Purchasing Agent\"/> <task id=\"node_73ad0cca-87ec-4780-bb9c-4bae9d82a5e9\" name=\"Amend Request for Quotation Requester\"/> <task id=\"node_3ec1d45e-5c69-4399-9fbb-8b978de5f5b6\" name=\"Send invoice\"/> <task id=\"node_679e5c12-c197-408e-8e36-b0caf31d5877\" name=\"Amend Request for Quotation Requester Manager\"/> <task id=\"node_63b26002-8b9f-4370-b93c-a6f6e6da1271\" name=\"Analyze Quotation comparison Map\"/> <task id=\"node_f348a00a-a47e-499e-9328-4b3d2191092a\" name=\"Create Request for Quotation Requester\"/> <exclusiveGateway id=\"node_f9b0faf4-317e-4c3c-8978-01ac7f12b078\" name=\"\" gatewayDirection=\"Converging\"> <incoming> node_a96e0b3d-eb85-41cf-b556-fcdc26aa6b30</incoming> <incoming> node_b63e74fd-599e-4f4f-8e0e-05b75f1d2f3b</incoming> <incoming> node_fbec00a0-cf79-4d1f-8d4e-9a9c0fa427fc</incoming> <incoming> node_2a4b3330-e272-448e-8d81-eab27e467b30</incoming> <outgoing> node_f8910d5d-8500-4988-bab5-d6b7ade35f53</outgoing> </exclusiveGateway> <exclusiveGateway id=\"node_167cc1b6-988e-4fc1-aa59-1f02251bffea\" name=\"\" gatewayDirection=\"Diverging\"> <incoming> node_5eb44de4-ebb2-4421-9d59-81fee36f98ef</incoming> <outgoing> node_4539c783-1563-459e-afd7-310512d615a5</outgoing> <outgoing> node_b4dfdff0-59c5-422a-9063-883f70b5e0cb</outgoing> <outgoing> node_7c788465-f8f7-4a37-b3ae-c603c72783ee</outgoing> </exclusiveGateway> <exclusiveGateway id=\"node_115dd9d9-ff4e-47c6-a8eb-67618031a30c\" name=\"\" gatewayDirection=\"Diverging\"> <incoming> node_8d900c7a-8c88-47a5-93a7-934a44c120aa</incoming> <outgoing> node_2f9d04b1-01d5-472b-86b1-b940a1b0ee89</outgoing> <outgoing> node_b66a3d50-0311-4695-a395-af67ce25911a</outgoing> </exclusiveGateway> <exclusiveGateway id=\"node_ff335ae6-62ff-409e-94ea-3c6d7248c631\" name=\"\" gatewayDirection=\"Converging\"> <incoming> node_b66a3d50-0311-4695-a395-af67ce25911a</incoming> <incoming> node_a3ad8fca-9452-4cf4-8648-952a3e994574</incoming> <outgoing> node_c29dbf24-13a1-49a4-98db-09b3bf1aeec6</outgoing> </exclusiveGateway> <exclusiveGateway id=\"node_d5542437-f47b-4163-9266-b04ed119092c\" name=\"\" gatewayDirection=\"Diverging\"> <incoming> node_9bdaf878-4841-4f6b-94a4-6ffc0609c89d</incoming> <outgoing> node_22a6cda1-6307-4dcb-b6e6-d4f5df293985</outgoing> <outgoing> node_1c86d6bf-994c-4b18-84b4-357a6f8e866a</outgoing> </exclusiveGateway> <exclusiveGateway id=\"node_c8b41406-7610-4c2d-8ce5-6449eeaefbc2\" name=\"\" gatewayDirection=\"Converging\"> <incoming> node_71977c4f-98c8-4845-973d-cc65acc6d707</incoming> <incoming> node_b8451bf6-dfda-45c3-a414-f20568ea0036</incoming> <outgoing> node_cac8f24b-b7d9-4088-b6ae-f14f3b81d3a2</outgoing> </exclusiveGateway> <exclusiveGateway id=\"node_2dede6df-b546-4b7e-894c-b8dd958327e0\" name=\"\" gatewayDirection=\"Diverging\"> <incoming> node_9faa800f-a1ff-4750-b3a9-cbe1f49cdb75</incoming> <outgoing> node_4e9383d7-6514-4113-ae7c-571755cdee06</outgoing> <outgoing> node_2c39a928-d6bd-43b5-b01d-28d7ee2800c8</outgoing> </exclusiveGateway> <sequenceFlow id=\"node_f8910d5d-8500-4988-bab5-d6b7ade35f53\" name=\"\" sourceRef=\"node_f9b0faf4-317e-4c3c-8978-01ac7f12b078\" targetRef=\"node_e22a1a5c-9d80-45f5-aa2a-9b484e1b941f\"/> <sequenceFlow id=\"node_5eb44de4-ebb2-4421-9d59-81fee36f98ef\" name=\"\" sourceRef=\"node_e22a1a5c-9d80-45f5-aa2a-9b484e1b941f\" targetRef=\"node_167cc1b6-988e-4fc1-aa59-1f02251bffea\"/> <sequenceFlow id=\"node_8d900c7a-8c88-47a5-93a7-934a44c120aa\" name=\"\" sourceRef=\"node_4da14501-1f17-4982-9af7-152b82ca3049\" targetRef=\"node_115dd9d9-ff4e-47c6-a8eb-67618031a30c\"/> <sequenceFlow id=\"node_c29dbf24-13a1-49a4-98db-09b3bf1aeec6\" name=\"\" sourceRef=\"node_ff335ae6-62ff-409e-94ea-3c6d7248c631\" targetRef=\"node_2570cd59-8515-4875-a859-7bd3d59aa1b5\"/> <sequenceFlow id=\"node_9bdaf878-4841-4f6b-94a4-6ffc0609c89d\" name=\"\" sourceRef=\"node_2570cd59-8515-4875-a859-7bd3d59aa1b5\" targetRef=\"node_d5542437-f47b-4163-9266-b04ed119092c\"/> <sequenceFlow id=\"node_cac8f24b-b7d9-4088-b6ae-f14f3b81d3a2\" name=\"\" sourceRef=\"node_c8b41406-7610-4c2d-8ce5-6449eeaefbc2\" targetRef=\"node_7a050268-19a8-41a9-88fa-58215d9755d0\"/> <sequenceFlow id=\"node_9faa800f-a1ff-4750-b3a9-cbe1f49cdb75\" name=\"\" sourceRef=\"node_7a050268-19a8-41a9-88fa-58215d9755d0\" targetRef=\"node_2dede6df-b546-4b7e-894c-b8dd958327e0\"/> <sequenceFlow id=\"node_36ca5d04-c4b1-4d64-878b-8523a9a66210\" name=\"\" sourceRef=\"node_4e061e76-de3f-44a8-bf33-d0027841b401\" targetRef=\"node_63b26002-8b9f-4370-b93c-a6f6e6da1271\"/> <sequenceFlow id=\"node_b8451bf6-dfda-45c3-a414-f20568ea0036\" name=\"\" sourceRef=\"node_26d059dd-ce9a-4def-8337-4feb4573c247\" targetRef=\"node_c8b41406-7610-4c2d-8ce5-6449eeaefbc2\"/> <sequenceFlow id=\"node_4e9383d7-6514-4113-ae7c-571755cdee06\" name=\"\" sourceRef=\"node_2dede6df-b546-4b7e-894c-b8dd958327e0\" targetRef=\"node_24b7edee-5b62-4e38-a101-25c4f3e353e6\"/> <sequenceFlow id=\"node_b129aad8-89c0-4509-826a-4706d727323a\" name=\"\" sourceRef=\"node_0690953b-b3b7-4ecc-bd55-734b49b632cc\" targetRef=\"node_4e061e76-de3f-44a8-bf33-d0027841b401\"/> <sequenceFlow id=\"node_71977c4f-98c8-4845-973d-cc65acc6d707\" name=\"\" sourceRef=\"node_b33ea688-0858-4332-a0cc-d8f2f847e964\" targetRef=\"node_c8b41406-7610-4c2d-8ce5-6449eeaefbc2\"/> <sequenceFlow id=\"node_79d86b5b-63cc-4d14-be3e-8d4eb5db5d59\" name=\"\" sourceRef=\"node_bd0945ae-f3c2-4251-8f84-0ba0f55fa1d3\" targetRef=\"node_e34db94d-833f-4db5-8f1e-db1fcd6a91b7\"/> <sequenceFlow id=\"node_22a6cda1-6307-4dcb-b6e6-d4f5df293985\" name=\"\" sourceRef=\"node_d5542437-f47b-4163-9266-b04ed119092c\" targetRef=\"node_c3998c0b-4472-47ae-ae33-9e83f3ce03cd\"/> <sequenceFlow id=\"node_a96e0b3d-eb85-41cf-b556-fcdc26aa6b30\" name=\"\" sourceRef=\"node_a5c2f628-1bbf-41c1-b02e-c16bec96b3b6\" targetRef=\"node_f9b0faf4-317e-4c3c-8978-01ac7f12b078\"/> <sequenceFlow id=\"node_2a4b3330-e272-448e-8d81-eab27e467b30\" name=\"\" sourceRef=\"node_679e5c12-c197-408e-8e36-b0caf31d5877\" targetRef=\"node_f9b0faf4-317e-4c3c-8978-01ac7f12b078\"/> <sequenceFlow id=\"node_a3ad8fca-9452-4cf4-8648-952a3e994574\" name=\"\" sourceRef=\"node_c3998c0b-4472-47ae-ae33-9e83f3ce03cd\" targetRef=\"node_ff335ae6-62ff-409e-94ea-3c6d7248c631\"/> <sequenceFlow id=\"node_1f4ba920-c135-444a-9361-022302c79760\" name=\"\" sourceRef=\"node_db5ccef7-17e2-47a8-8990-074f4f9f2331\" targetRef=\"node_8d4e67ae-07df-4fae-880c-599ee93c2fd2\"/> <sequenceFlow id=\"node_de395961-32de-4b5b-8c89-34ad35991803\" name=\"\" sourceRef=\"node_58f25b2e-df26-4456-a9d8-57eb6ca96144\" targetRef=\"node_27d3ecb2-fa4f-46e4-9f1b-f9313610ef01\"/> <sequenceFlow id=\"node_3721be08-d8f9-47ac-b641-b826a4ca67ce\" name=\"\" sourceRef=\"node_63b26002-8b9f-4370-b93c-a6f6e6da1271\" targetRef=\"node_db5ccef7-17e2-47a8-8990-074f4f9f2331\"/> <sequenceFlow id=\"node_b63e74fd-599e-4f4f-8e0e-05b75f1d2f3b\" name=\"\" sourceRef=\"node_f348a00a-a47e-499e-9328-4b3d2191092a\" targetRef=\"node_f9b0faf4-317e-4c3c-8978-01ac7f12b078\"/> <sequenceFlow id=\"node_886f2e69-3245-48a5-bed7-4dc6533211b1\" name=\"\" sourceRef=\"node_8d4e67ae-07df-4fae-880c-599ee93c2fd2\" targetRef=\"node_bd0945ae-f3c2-4251-8f84-0ba0f55fa1d3\"/> <sequenceFlow id=\"node_1c86d6bf-994c-4b18-84b4-357a6f8e866a\" name=\"\" sourceRef=\"node_d5542437-f47b-4163-9266-b04ed119092c\" targetRef=\"node_a5c2f628-1bbf-41c1-b02e-c16bec96b3b6\"/> <sequenceFlow id=\"node_4f7fa38a-f2df-4177-a524-7a921dcbb022\" name=\"\" sourceRef=\"node_608c9ab1-1df4-4957-88cb-228ba60cabe3\" targetRef=\"node_4da14501-1f17-4982-9af7-152b82ca3049\"/> <sequenceFlow id=\"node_9a95f345-2fde-48b3-acc6-ea123e68152e\" name=\"\" sourceRef=\"node_dc448366-b458-40e4-8d5c-8617031e2f78\" targetRef=\"node_16639e84-f9d2-4ae7-b20b-d12de4012a10\"/> <sequenceFlow id=\"node_2c39a928-d6bd-43b5-b01d-28d7ee2800c8\" name=\"\" sourceRef=\"node_2dede6df-b546-4b7e-894c-b8dd958327e0\" targetRef=\"node_26d059dd-ce9a-4def-8337-4feb4573c247\"/> <sequenceFlow id=\"node_ebedfb48-f0a6-42de-9a74-31070a5868f9\" name=\"\" sourceRef=\"node_16639e84-f9d2-4ae7-b20b-d12de4012a10\" targetRef=\"node_58f25b2e-df26-4456-a9d8-57eb6ca96144\"/> <sequenceFlow id=\"node_fbec00a0-cf79-4d1f-8d4e-9a9c0fa427fc\" name=\"\" sourceRef=\"node_73ad0cca-87ec-4780-bb9c-4bae9d82a5e9\" targetRef=\"node_f9b0faf4-317e-4c3c-8978-01ac7f12b078\"/> <sequenceFlow id=\"node_753a9377-e561-41f2-859d-6536b281c79b\" name=\"\" sourceRef=\"node_3ec1d45e-5c69-4399-9fbb-8b978de5f5b6\" targetRef=\"node_8b895566-e2cb-4b59-8289-188758953e5c\"/> <sequenceFlow id=\"node_7c788465-f8f7-4a37-b3ae-c603c72783ee\" name=\"\" sourceRef=\"node_167cc1b6-988e-4fc1-aa59-1f02251bffea\" targetRef=\"node_73ad0cca-87ec-4780-bb9c-4bae9d82a5e9\"/> <sequenceFlow id=\"node_aed316a7-ad8b-44d5-8007-3471fc80b7d2\" name=\"\" sourceRef=\"node_e34db94d-833f-4db5-8f1e-db1fcd6a91b7\" targetRef=\"node_b33ea688-0858-4332-a0cc-d8f2f847e964\"/> <sequenceFlow id=\"node_d09eef36-53e4-4197-b56a-3ec38f45206c\" name=\"\" sourceRef=\"node_24b7edee-5b62-4e38-a101-25c4f3e353e6\" targetRef=\"node_3ec1d45e-5c69-4399-9fbb-8b978de5f5b6\"/> <sequenceFlow id=\"node_b62473f9-3e73-4434-ad6f-28e1cb0a8a3c\" name=\"\" sourceRef=\"node_8b895566-e2cb-4b59-8289-188758953e5c\" targetRef=\"node_dc448366-b458-40e4-8d5c-8617031e2f78\"/> <sequenceFlow id=\"node_2f9d04b1-01d5-472b-86b1-b940a1b0ee89\" name=\"\" sourceRef=\"node_115dd9d9-ff4e-47c6-a8eb-67618031a30c\" targetRef=\"node_f348a00a-a47e-499e-9328-4b3d2191092a\"/> <sequenceFlow id=\"node_4539c783-1563-459e-afd7-310512d615a5\" name=\"\" sourceRef=\"node_167cc1b6-988e-4fc1-aa59-1f02251bffea\" targetRef=\"node_679e5c12-c197-408e-8e36-b0caf31d5877\"/> <sequenceFlow id=\"node_b4dfdff0-59c5-422a-9063-883f70b5e0cb\" name=\"\" sourceRef=\"node_167cc1b6-988e-4fc1-aa59-1f02251bffea\" targetRef=\"node_0690953b-b3b7-4ecc-bd55-734b49b632cc\"/> <sequenceFlow id=\"node_b66a3d50-0311-4695-a395-af67ce25911a\" name=\"\" sourceRef=\"node_115dd9d9-ff4e-47c6-a8eb-67618031a30c\" targetRef=\"node_ff335ae6-62ff-409e-94ea-3c6d7248c631\"/> </process> <bpmndi:BPMNDiagram id=\"id_960881858\"> <bpmndi:BPMNPlane bpmnElement=\"proc_11500656\"> <bpmndi:BPMNShape bpmnElement=\"node_e22a1a5c-9d80-45f5-aa2a-9b484e1b941f\"> <dc:Bounds x=\"821.0\" y=\"171.0\" width=\"80.0\" height=\"40.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNShape bpmnElement=\"node_db5ccef7-17e2-47a8-8990-074f4f9f2331\"> <dc:Bounds x=\"1416.0\" y=\"171.0\" width=\"80.0\" height=\"40.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNShape bpmnElement=\"node_0690953b-b3b7-4ecc-bd55-734b49b632cc\"> <dc:Bounds x=\"1026.0\" y=\"171.0\" width=\"80.0\" height=\"40.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNShape bpmnElement=\"node_24b7edee-5b62-4e38-a101-25c4f3e353e6\"> <dc:Bounds x=\"2346.0\" y=\"217.0\" width=\"80.0\" height=\"40.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNShape bpmnElement=\"node_8b895566-e2cb-4b59-8289-188758953e5c\"> <dc:Bounds x=\"2606.0\" y=\"193.0\" width=\"80.0\" height=\"40.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNShape bpmnElement=\"node_a5c2f628-1bbf-41c1-b02e-c16bec96b3b6\"> <dc:Bounds x=\"616.0\" y=\"191.0\" width=\"80.0\" height=\"40.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNShape bpmnElement=\"node_27d3ecb2-fa4f-46e4-9f1b-f9313610ef01\"> <dc:Bounds x=\"3126.0\" y=\"184.5\" width=\"25.0\" height=\"25.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNShape bpmnElement=\"node_bd0945ae-f3c2-4251-8f84-0ba0f55fa1d3\"> <dc:Bounds x=\"1676.0\" y=\"171.0\" width=\"80.0\" height=\"40.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNShape bpmnElement=\"node_16639e84-f9d2-4ae7-b20b-d12de4012a10\"> <dc:Bounds x=\"2866.0\" y=\"180.0\" width=\"80.0\" height=\"40.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNShape bpmnElement=\"node_679e5c12-c197-408e-8e36-b0caf31d5877\"> <dc:Bounds x=\"1026.0\" y=\"241.0\" width=\"80.0\" height=\"40.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNShape bpmnElement=\"node_73ad0cca-87ec-4780-bb9c-4bae9d82a5e9\"> <dc:Bounds x=\"1026.0\" y=\"101.0\" width=\"80.0\" height=\"40.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNShape bpmnElement=\"node_e34db94d-833f-4db5-8f1e-db1fcd6a91b7\"> <dc:Bounds x=\"1806.0\" y=\"171.0\" width=\"80.0\" height=\"40.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNShape bpmnElement=\"node_b33ea688-0858-4332-a0cc-d8f2f847e964\"> <dc:Bounds x=\"1936.0\" y=\"171.0\" width=\"80.0\" height=\"40.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNShape bpmnElement=\"node_4e061e76-de3f-44a8-bf33-d0027841b401\"> <dc:Bounds x=\"1156.0\" y=\"171.0\" width=\"80.0\" height=\"40.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNShape bpmnElement=\"node_2dede6df-b546-4b7e-894c-b8dd958327e0\"> <dc:Bounds x=\"2271.0\" y=\"196.5\" width=\"25.0\" height=\"25.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNShape bpmnElement=\"node_3ec1d45e-5c69-4399-9fbb-8b978de5f5b6\"> <dc:Bounds x=\"2476.0\" y=\"204.0\" width=\"80.0\" height=\"40.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNShape bpmnElement=\"node_26d059dd-ce9a-4def-8337-4feb4573c247\"> <dc:Bounds x=\"2346.0\" y=\"147.0\" width=\"80.0\" height=\"40.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNShape bpmnElement=\"node_8d4e67ae-07df-4fae-880c-599ee93c2fd2\"> <dc:Bounds x=\"1546.0\" y=\"171.0\" width=\"80.0\" height=\"40.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNShape bpmnElement=\"node_115dd9d9-ff4e-47c6-a8eb-67618031a30c\"> <dc:Bounds x=\"206.0\" y=\"184.5\" width=\"25.0\" height=\"25.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNShape bpmnElement=\"node_4da14501-1f17-4982-9af7-152b82ca3049\"> <dc:Bounds x=\"76.0\" y=\"174.0\" width=\"80.0\" height=\"40.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNShape bpmnElement=\"node_2570cd59-8515-4875-a859-7bd3d59aa1b5\"> <dc:Bounds x=\"411.0\" y=\"166.0\" width=\"80.0\" height=\"40.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNShape bpmnElement=\"node_c8b41406-7610-4c2d-8ce5-6449eeaefbc2\"> <dc:Bounds x=\"2066.0\" y=\"181.5\" width=\"25.0\" height=\"25.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNShape bpmnElement=\"node_63b26002-8b9f-4370-b93c-a6f6e6da1271\"> <dc:Bounds x=\"1286.0\" y=\"171.0\" width=\"80.0\" height=\"40.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNShape bpmnElement=\"node_f348a00a-a47e-499e-9328-4b3d2191092a\"> <dc:Bounds x=\"281.0\" y=\"212.0\" width=\"80.0\" height=\"40.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNShape bpmnElement=\"node_167cc1b6-988e-4fc1-aa59-1f02251bffea\"> <dc:Bounds x=\"951.0\" y=\"178.5\" width=\"25.0\" height=\"25.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNShape bpmnElement=\"node_7a050268-19a8-41a9-88fa-58215d9755d0\"> <dc:Bounds x=\"2141.0\" y=\"201.0\" width=\"80.0\" height=\"40.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNShape bpmnElement=\"node_608c9ab1-1df4-4957-88cb-228ba60cabe3\"> <dc:Bounds x=\"1.0\" y=\"181.5\" width=\"25.0\" height=\"25.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNShape bpmnElement=\"node_f9b0faf4-317e-4c3c-8978-01ac7f12b078\"> <dc:Bounds x=\"746.0\" y=\"196.5\" width=\"25.0\" height=\"25.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNShape bpmnElement=\"node_ff335ae6-62ff-409e-94ea-3c6d7248c631\"> <dc:Bounds x=\"308.5\" y=\"157.5\" width=\"25.0\" height=\"25.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNShape bpmnElement=\"node_58f25b2e-df26-4456-a9d8-57eb6ca96144\"> <dc:Bounds x=\"2996.0\" y=\"177.0\" width=\"80.0\" height=\"40.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNShape bpmnElement=\"node_d5542437-f47b-4163-9266-b04ed119092c\"> <dc:Bounds x=\"541.0\" y=\"166.5\" width=\"25.0\" height=\"25.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNShape bpmnElement=\"node_dc448366-b458-40e4-8d5c-8617031e2f78\"> <dc:Bounds x=\"2736.0\" y=\"185.0\" width=\"80.0\" height=\"40.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNShape bpmnElement=\"node_c3998c0b-4472-47ae-ae33-9e83f3ce03cd\"> <dc:Bounds x=\"616.0\" y=\"121.0\" width=\"80.0\" height=\"40.0\"/> <bpmndi:BPMNLabel/> </bpmndi:BPMNShape> <bpmndi:BPMNEdge bpmnElement=\"node_b8451bf6-dfda-45c3-a414-f20568ea0036\"> <di:waypoint x=\"2386.0\" y=\"167.0\"/> <di:waypoint x=\"2283.5\" y=\"152.0\"/> <di:waypoint x=\"2181.0\" y=\"152.0\"/> <di:waypoint x=\"2078.5\" y=\"194.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_22a6cda1-6307-4dcb-b6e6-d4f5df293985\"> <di:waypoint x=\"553.5\" y=\"179.0\"/> <di:waypoint x=\"656.0\" y=\"141.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_9bdaf878-4841-4f6b-94a4-6ffc0609c89d\"> <di:waypoint x=\"451.0\" y=\"186.0\"/> <di:waypoint x=\"553.5\" y=\"179.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_4539c783-1563-459e-afd7-310512d615a5\"> <di:waypoint x=\"963.5\" y=\"191.0\"/> <di:waypoint x=\"1066.0\" y=\"261.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_a3ad8fca-9452-4cf4-8648-952a3e994574\"> <di:waypoint x=\"656.0\" y=\"141.0\"/> <di:waypoint x=\"553.5\" y=\"136.0\"/> <di:waypoint x=\"451.0\" y=\"136.0\"/> <di:waypoint x=\"321.0\" y=\"170.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_d09eef36-53e4-4197-b56a-3ec38f45206c\"> <di:waypoint x=\"2386.0\" y=\"237.0\"/> <di:waypoint x=\"2516.0\" y=\"224.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_fbec00a0-cf79-4d1f-8d4e-9a9c0fa427fc\"> <di:waypoint x=\"1066.0\" y=\"121.0\"/> <di:waypoint x=\"963.5\" y=\"141.0\"/> <di:waypoint x=\"861.0\" y=\"141.0\"/> <di:waypoint x=\"758.5\" y=\"209.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_b129aad8-89c0-4509-826a-4706d727323a\"> <di:waypoint x=\"1066.0\" y=\"191.0\"/> <di:waypoint x=\"1196.0\" y=\"191.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_886f2e69-3245-48a5-bed7-4dc6533211b1\"> <di:waypoint x=\"1586.0\" y=\"191.0\"/> <di:waypoint x=\"1716.0\" y=\"191.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_b63e74fd-599e-4f4f-8e0e-05b75f1d2f3b\"> <di:waypoint x=\"321.0\" y=\"232.0\"/> <di:waypoint x=\"451.0\" y=\"261.0\"/> <di:waypoint x=\"553.5\" y=\"261.0\"/> <di:waypoint x=\"656.0\" y=\"261.0\"/> <di:waypoint x=\"758.5\" y=\"209.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_cac8f24b-b7d9-4088-b6ae-f14f3b81d3a2\"> <di:waypoint x=\"2078.5\" y=\"194.0\"/> <di:waypoint x=\"2181.0\" y=\"221.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_2a4b3330-e272-448e-8d81-eab27e467b30\"> <di:waypoint x=\"1066.0\" y=\"261.0\"/> <di:waypoint x=\"963.5\" y=\"241.0\"/> <di:waypoint x=\"861.0\" y=\"241.0\"/> <di:waypoint x=\"758.5\" y=\"209.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_5eb44de4-ebb2-4421-9d59-81fee36f98ef\"> <di:waypoint x=\"861.0\" y=\"191.0\"/> <di:waypoint x=\"963.5\" y=\"191.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_aed316a7-ad8b-44d5-8007-3471fc80b7d2\"> <di:waypoint x=\"1846.0\" y=\"191.0\"/> <di:waypoint x=\"1976.0\" y=\"191.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_f8910d5d-8500-4988-bab5-d6b7ade35f53\"> <di:waypoint x=\"758.5\" y=\"209.0\"/> <di:waypoint x=\"861.0\" y=\"191.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_8d900c7a-8c88-47a5-93a7-934a44c120aa\"> <di:waypoint x=\"116.0\" y=\"194.0\"/> <di:waypoint x=\"218.5\" y=\"197.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_4e9383d7-6514-4113-ae7c-571755cdee06\"> <di:waypoint x=\"2283.5\" y=\"209.0\"/> <di:waypoint x=\"2386.0\" y=\"237.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_9faa800f-a1ff-4750-b3a9-cbe1f49cdb75\"> <di:waypoint x=\"2181.0\" y=\"221.0\"/> <di:waypoint x=\"2283.5\" y=\"209.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_9a95f345-2fde-48b3-acc6-ea123e68152e\"> <di:waypoint x=\"2776.0\" y=\"205.0\"/> <di:waypoint x=\"2906.0\" y=\"200.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_753a9377-e561-41f2-859d-6536b281c79b\"> <di:waypoint x=\"2516.0\" y=\"224.0\"/> <di:waypoint x=\"2646.0\" y=\"213.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_2f9d04b1-01d5-472b-86b1-b940a1b0ee89\"> <di:waypoint x=\"218.5\" y=\"197.0\"/> <di:waypoint x=\"321.0\" y=\"232.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_3721be08-d8f9-47ac-b641-b826a4ca67ce\"> <di:waypoint x=\"1326.0\" y=\"191.0\"/> <di:waypoint x=\"1456.0\" y=\"191.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_b4dfdff0-59c5-422a-9063-883f70b5e0cb\"> <di:waypoint x=\"963.5\" y=\"191.0\"/> <di:waypoint x=\"1066.0\" y=\"191.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_de395961-32de-4b5b-8c89-34ad35991803\"> <di:waypoint x=\"3036.0\" y=\"197.0\"/> <di:waypoint x=\"3138.5\" y=\"197.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_71977c4f-98c8-4845-973d-cc65acc6d707\"> <di:waypoint x=\"1976.0\" y=\"191.0\"/> <di:waypoint x=\"2078.5\" y=\"194.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_b66a3d50-0311-4695-a395-af67ce25911a\"> <di:waypoint x=\"218.5\" y=\"197.0\"/> <di:waypoint x=\"321.0\" y=\"170.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_79d86b5b-63cc-4d14-be3e-8d4eb5db5d59\"> <di:waypoint x=\"1716.0\" y=\"191.0\"/> <di:waypoint x=\"1846.0\" y=\"191.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_36ca5d04-c4b1-4d64-878b-8523a9a66210\"> <di:waypoint x=\"1196.0\" y=\"191.0\"/> <di:waypoint x=\"1326.0\" y=\"191.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_2c39a928-d6bd-43b5-b01d-28d7ee2800c8\"> <di:waypoint x=\"2283.5\" y=\"209.0\"/> <di:waypoint x=\"2386.0\" y=\"167.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_ebedfb48-f0a6-42de-9a74-31070a5868f9\"> <di:waypoint x=\"2906.0\" y=\"200.0\"/> <di:waypoint x=\"3036.0\" y=\"197.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_c29dbf24-13a1-49a4-98db-09b3bf1aeec6\"> <di:waypoint x=\"321.0\" y=\"170.0\"/> <di:waypoint x=\"451.0\" y=\"186.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_4f7fa38a-f2df-4177-a524-7a921dcbb022\"> <di:waypoint x=\"13.5\" y=\"194.0\"/> <di:waypoint x=\"116.0\" y=\"194.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_7c788465-f8f7-4a37-b3ae-c603c72783ee\"> <di:waypoint x=\"963.5\" y=\"191.0\"/> <di:waypoint x=\"1066.0\" y=\"121.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_1c86d6bf-994c-4b18-84b4-357a6f8e866a\"> <di:waypoint x=\"553.5\" y=\"179.0\"/> <di:waypoint x=\"656.0\" y=\"211.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_b62473f9-3e73-4434-ad6f-28e1cb0a8a3c\"> <di:waypoint x=\"2646.0\" y=\"213.0\"/> <di:waypoint x=\"2776.0\" y=\"205.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_a96e0b3d-eb85-41cf-b556-fcdc26aa6b30\"> <di:waypoint x=\"656.0\" y=\"211.0\"/> <di:waypoint x=\"758.5\" y=\"209.0\"/> </bpmndi:BPMNEdge> <bpmndi:BPMNEdge bpmnElement=\"node_1f4ba920-c135-444a-9361-022302c79760\"> <di:waypoint x=\"1456.0\" y=\"191.0\"/> <di:waypoint x=\"1586.0\" y=\"191.0\"/> </bpmndi:BPMNEdge> </bpmndi:BPMNPlane> </bpmndi:BPMNDiagram> </definitions>";

        String layout = "{\"elements\":{\"nodes\":[{\"data\":{\"shape\":\"roundrectangle\",\"color\":\"#efedf5\",\"name\":\"Amend Purchase Requisition\\n\\n11\",\"width\":\"161px\",\"id\":\"1\",\"textwidth\":\"151px\",\"height\":\"30px\"},\"position\":{\"x\":163.5,\"y\":234},\"group\":\"nodes\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"shape\":\"roundrectangle\",\"color\":\"#83a9c5\",\"name\":\"Amend Request for Quotation Requester\\n\\n514\",\"width\":\"161px\",\"id\":\"2\",\"textwidth\":\"151px\",\"height\":\"30px\"},\"position\":{\"x\":1055.5,\"y\":21},\"group\":\"nodes\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"shape\":\"roundrectangle\",\"color\":\"#e7e7f1\",\"name\":\"Amend Request for Quotation Requester Manager\\n\\n49\",\"width\":\"161px\",\"id\":\"3\",\"textwidth\":\"151px\",\"height\":\"30px\"},\"position\":{\"x\":1055.5,\"y\":163},\"group\":\"nodes\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"shape\":\"roundrectangle\",\"color\":\"#9fbbd2\",\"name\":\"Analyze Purchase Requisition\\n\\n382\",\"width\":\"161px\",\"id\":\"4\",\"textwidth\":\"151px\",\"height\":\"30px\"},\"position\":{\"x\":386.5,\"y\":166},\"group\":\"nodes\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"shape\":\"roundrectangle\",\"color\":\"#99b7cf\",\"name\":\"Analyze Quotation comparison Map\\n\\n413\",\"width\":\"161px\",\"id\":\"5\",\"textwidth\":\"151px\",\"height\":\"30px\"},\"position\":{\"x\":1501.5,\"y\":305},\"group\":\"nodes\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"shape\":\"roundrectangle\",\"color\":\"#045a8d\",\"name\":\"Analyze Request for Quotation\\n\\n1107\",\"width\":\"161px\",\"id\":\"6\",\"textwidth\":\"151px\",\"height\":\"30px\"},\"position\":{\"x\":832.5,\"y\":163},\"group\":\"nodes\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"shape\":\"roundrectangle\",\"color\":\"#99b7cf\",\"name\":\"Approve Purchase Order for payment\\n\\n413\",\"width\":\"161px\",\"id\":\"7\",\"textwidth\":\"151px\",\"height\":\"30px\"},\"position\":{\"x\":3062.5,\"y\":165},\"group\":\"nodes\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"shape\":\"roundrectangle\",\"color\":\"#99b7cf\",\"name\":\"Authorize Suppliers Invoice payment\\n\\n413\",\"width\":\"161px\",\"id\":\"8\",\"textwidth\":\"151px\",\"height\":\"30px\"},\"position\":{\"x\":3954.5,\"y\":165},\"group\":\"nodes\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"shape\":\"roundrectangle\",\"color\":\"#99b7cf\",\"name\":\"Choose best option\\n\\n413\",\"width\":\"161px\",\"id\":\"9\",\"textwidth\":\"151px\",\"height\":\"30px\"},\"position\":{\"x\":1724.5,\"y\":305},\"group\":\"nodes\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"shape\":\"roundrectangle\",\"color\":\"#99b7cf\",\"name\":\"Confirm Purchase Order\\n\\n413\",\"width\":\"161px\",\"id\":\"10\",\"textwidth\":\"151px\",\"height\":\"30px\"},\"position\":{\"x\":2393.5,\"y\":305},\"group\":\"nodes\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"shape\":\"roundrectangle\",\"color\":\"#99b7cf\",\"name\":\"Create Purchase Order\\n\\n413\",\"width\":\"161px\",\"id\":\"11\",\"textwidth\":\"151px\",\"height\":\"30px\"},\"position\":{\"x\":2170.5,\"y\":305},\"group\":\"nodes\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"shape\":\"roundrectangle\",\"color\":\"#6f9dbc\",\"name\":\"Create Purchase Requisition\\n\\n608\",\"width\":\"161px\",\"id\":\"12\",\"textwidth\":\"151px\",\"height\":\"30px\"},\"position\":{\"x\":163.5,\"y\":92},\"group\":\"nodes\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"shape\":\"roundrectangle\",\"color\":\"#99b7cf\",\"name\":\"Create Quotation comparison Map\\n\\n413\",\"width\":\"161px\",\"id\":\"13\",\"textwidth\":\"151px\",\"height\":\"30px\"},\"position\":{\"x\":1278.5,\"y\":305},\"group\":\"nodes\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"shape\":\"roundrectangle\",\"color\":\"#becee0\",\"name\":\"Create Request for Quotation Requester\\n\\n237\",\"width\":\"161px\",\"id\":\"14\",\"textwidth\":\"151px\",\"height\":\"30px\"},\"position\":{\"x\":609.5,\"y\":23},\"group\":\"nodes\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"shape\":\"roundrectangle\",\"color\":\"#afc5d9\",\"name\":\"Create Request for Quotation Requester Manager\\n\\n307\",\"width\":\"161px\",\"id\":\"15\",\"textwidth\":\"151px\",\"height\":\"30px\"},\"position\":{\"x\":609.5,\"y\":166},\"group\":\"nodes\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"shape\":\"roundrectangle\",\"color\":\"#99b7cf\",\"name\":\"Deliver Goods Services\\n\\n413\",\"width\":\"161px\",\"id\":\"16\",\"textwidth\":\"151px\",\"height\":\"30px\"},\"position\":{\"x\":2616.5,\"y\":305},\"group\":\"nodes\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"shape\":\"roundrectangle\",\"color\":\"#99b7cf\",\"name\":\"Pay invoice\\n\\n413\",\"width\":\"161px\",\"id\":\"17\",\"textwidth\":\"151px\",\"height\":\"30px\"},\"position\":{\"x\":4177.5,\"y\":165},\"group\":\"nodes\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"shape\":\"roundrectangle\",\"color\":\"#93b3cc\",\"name\":\"Release Purchase Order\\n\\n439\",\"width\":\"161px\",\"id\":\"18\",\"textwidth\":\"151px\",\"height\":\"30px\"},\"position\":{\"x\":2839.5,\"y\":305},\"group\":\"nodes\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"shape\":\"roundrectangle\",\"color\":\"#9bb8d0\",\"name\":\"Release Suppliers Invoice\\n\\n403\",\"width\":\"161px\",\"id\":\"19\",\"textwidth\":\"151px\",\"height\":\"30px\"},\"position\":{\"x\":3508.5,\"y\":165},\"group\":\"nodes\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"shape\":\"roundrectangle\",\"color\":\"#99b7cf\",\"name\":\"Send Request for Quotation to Supplier\\n\\n413\",\"width\":\"161px\",\"id\":\"20\",\"textwidth\":\"151px\",\"height\":\"30px\"},\"position\":{\"x\":1055.5,\"y\":305},\"group\":\"nodes\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"shape\":\"roundrectangle\",\"color\":\"#99b7cf\",\"name\":\"Send invoice\\n\\n413\",\"width\":\"161px\",\"id\":\"21\",\"textwidth\":\"151px\",\"height\":\"30px\"},\"position\":{\"x\":3285.5,\"y\":165},\"group\":\"nodes\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"shape\":\"roundrectangle\",\"color\":\"#99b7cf\",\"name\":\"Settle conditions with supplier\\n\\n413\",\"width\":\"161px\",\"id\":\"22\",\"textwidth\":\"151px\",\"height\":\"30px\"},\"position\":{\"x\":1947.5,\"y\":305},\"group\":\"nodes\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"shape\":\"roundrectangle\",\"color\":\"#e0e3ee\",\"name\":\"Settle dispute with supplier Financial Manager\\n\\n80\",\"width\":\"161px\",\"id\":\"23\",\"textwidth\":\"151px\",\"height\":\"30px\"},\"position\":{\"x\":3731.5,\"y\":165},\"group\":\"nodes\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"shape\":\"roundrectangle\",\"color\":\"#ebebf4\",\"name\":\"Settle dispute with supplier Purchasing Agent\\n\\n26\",\"width\":\"161px\",\"id\":\"24\",\"textwidth\":\"151px\",\"height\":\"30px\"},\"position\":{\"x\":3062.5,\"y\":307},\"group\":\"nodes\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"shape\":\"ellipse\",\"color\":\"#C0A3A1\",\"name\":\"\",\"width\":\"15px\",\"id\":\"25\",\"textwidth\":\"151px\",\"height\":\"15px\"},\"position\":{\"x\":4327.5,\"y\":165},\"group\":\"nodes\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"shape\":\"ellipse\",\"color\":\"#C1C9B0\",\"name\":\"\",\"width\":\"15px\",\"id\":\"26\",\"textwidth\":\"151px\",\"height\":\"15px\"},\"position\":{\"x\":13.5,\"y\":92},\"group\":\"nodes\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"}],\"edges\":[{\"data\":{\"strength\":1.32,\"color\":\"#636363\",\"style\":\"solid\",\"source\":\"1\",\"label\":\"8\",\"target\":\"4\",\"id\":\"c3a7f301-8b09-450d-8f1e-a00d4df52adb\"},\"position\":{},\"group\":\"edges\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"strength\":84.54,\"color\":\"#323232\",\"style\":\"solid\",\"source\":\"2\",\"label\":\"514\",\"target\":\"6\",\"id\":\"2b0ccd02-d92a-42a6-869e-016a9d2b2d68\"},\"position\":{},\"group\":\"edges\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"strength\":8.06,\"color\":\"#5f5f5f\",\"style\":\"solid\",\"source\":\"3\",\"label\":\"49\",\"target\":\"6\",\"id\":\"840611e4-37d1-4878-b458-7e38673ff30c\"},\"position\":{},\"group\":\"edges\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"strength\":1.81,\"color\":\"#636363\",\"style\":\"solid\",\"source\":\"4\",\"label\":\"11\",\"target\":\"1\",\"id\":\"5766510b-5d9b-466d-9d19-e4c9d80f83f3\"},\"position\":{},\"group\":\"edges\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"strength\":50.49,\"color\":\"#464646\",\"style\":\"solid\",\"source\":\"4\",\"label\":\"307\",\"target\":\"15\",\"id\":\"8f8473a8-1f74-452e-a629-138de818ae6c\"},\"position\":{},\"group\":\"edges\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"strength\":67.93,\"color\":\"#3c3c3c\",\"style\":\"solid\",\"source\":\"5\",\"label\":\"413\",\"target\":\"9\",\"id\":\"9210ee74-33a6-4c03-a579-abc2334bc675\"},\"position\":{},\"group\":\"edges\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"strength\":84.54,\"color\":\"#323232\",\"style\":\"solid\",\"source\":\"6\",\"label\":\"514\",\"target\":\"2\",\"id\":\"dd1f9a6a-6d5a-4439-87a9-c95bc5c551ac\"},\"position\":{},\"group\":\"edges\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"strength\":8.06,\"color\":\"#5f5f5f\",\"style\":\"solid\",\"source\":\"6\",\"label\":\"49\",\"target\":\"3\",\"id\":\"08ea36cd-2482-4a73-bfb3-eb7ddaa4eb3b\"},\"position\":{},\"group\":\"edges\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"strength\":67.93,\"color\":\"#3c3c3c\",\"style\":\"solid\",\"source\":\"6\",\"label\":\"413\",\"target\":\"20\",\"id\":\"731a3920-41c1-452f-a805-01ee4361288c\"},\"position\":{},\"group\":\"edges\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"strength\":67.93,\"color\":\"#3c3c3c\",\"style\":\"solid\",\"source\":\"7\",\"label\":\"413\",\"target\":\"21\",\"id\":\"7ced29a3-b9f0-4efb-8cba-b7073fa4346d\"},\"position\":{},\"group\":\"edges\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"strength\":67.93,\"color\":\"#3c3c3c\",\"style\":\"solid\",\"source\":\"8\",\"label\":\"413\",\"target\":\"17\",\"id\":\"7a8b2030-9e87-4675-a8a9-5b1b9e8b0299\"},\"position\":{},\"group\":\"edges\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"strength\":67.93,\"color\":\"#3c3c3c\",\"style\":\"solid\",\"source\":\"9\",\"label\":\"413\",\"target\":\"22\",\"id\":\"2b2f0990-9f06-4472-8c42-a2ed669dc197\"},\"position\":{},\"group\":\"edges\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"strength\":67.93,\"color\":\"#3c3c3c\",\"style\":\"solid\",\"source\":\"10\",\"label\":\"413\",\"target\":\"16\",\"id\":\"a5b5d25d-7892-4e37-a89d-a98feb8e994f\"},\"position\":{},\"group\":\"edges\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"strength\":67.93,\"color\":\"#3c3c3c\",\"style\":\"solid\",\"source\":\"11\",\"label\":\"413\",\"target\":\"10\",\"id\":\"7c705ad5-618f-4ced-9da7-b5c45cba8595\"},\"position\":{},\"group\":\"edges\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"strength\":61.51,\"color\":\"#404040\",\"style\":\"solid\",\"source\":\"12\",\"label\":\"374\",\"target\":\"4\",\"id\":\"19eb7c06-7e3d-4447-bf92-f7b7aa627ef7\"},\"position\":{},\"group\":\"edges\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"strength\":38.49,\"color\":\"#4d4d4d\",\"style\":\"solid\",\"source\":\"12\",\"label\":\"234\",\"target\":\"14\",\"id\":\"ef1e06e0-b9ed-463d-821a-dbee012eb8e0\"},\"position\":{},\"group\":\"edges\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"strength\":67.93,\"color\":\"#3c3c3c\",\"style\":\"solid\",\"source\":\"13\",\"label\":\"413\",\"target\":\"5\",\"id\":\"fc4ecdec-4bf5-46b1-aa44-5f5785665bac\"},\"position\":{},\"group\":\"edges\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"strength\":38.98,\"color\":\"#4d4d4d\",\"style\":\"solid\",\"source\":\"14\",\"label\":\"237\",\"target\":\"6\",\"id\":\"9adbf384-dc91-42cb-95a8-b10734ab69c9\"},\"position\":{},\"group\":\"edges\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"strength\":50.49,\"color\":\"#464646\",\"style\":\"solid\",\"source\":\"15\",\"label\":\"307\",\"target\":\"6\",\"id\":\"c0fdfaf7-fa90-413c-9887-5cd679929ce6\"},\"position\":{},\"group\":\"edges\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"strength\":67.93,\"color\":\"#3c3c3c\",\"style\":\"solid\",\"source\":\"16\",\"label\":\"413\",\"target\":\"18\",\"id\":\"2674030f-eb58-4402-bb02-beac4915b9a5\"},\"position\":{},\"group\":\"edges\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"strength\":67.93,\"color\":\"#3c3c3c\",\"style\":\"dashed\",\"source\":\"17\",\"label\":\"413\",\"target\":\"25\",\"id\":\"83e8b293-af0f-4f07-bcbd-e0192604c330\"},\"position\":{},\"group\":\"edges\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"strength\":67.93,\"color\":\"#3c3c3c\",\"style\":\"solid\",\"source\":\"18\",\"label\":\"413\",\"target\":\"7\",\"id\":\"825bb6a7-9826-455e-b3d0-fa5db5d35182\"},\"position\":{},\"group\":\"edges\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"strength\":4.28,\"color\":\"#616161\",\"style\":\"solid\",\"source\":\"18\",\"label\":\"26\",\"target\":\"24\",\"id\":\"1668d7a7-7d1d-41ce-b50c-d8d056b0b0e7\"},\"position\":{},\"group\":\"edges\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"strength\":13.16,\"color\":\"#5c5c5c\",\"style\":\"solid\",\"source\":\"19\",\"label\":\"80\",\"target\":\"23\",\"id\":\"bb2103b5-948a-47f3-8e7f-489a1e1737ca\"},\"position\":{},\"group\":\"edges\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"strength\":67.93,\"color\":\"#3c3c3c\",\"style\":\"solid\",\"source\":\"20\",\"label\":\"413\",\"target\":\"13\",\"id\":\"5415882a-ab18-4ae0-a3b8-e8190cd996ef\"},\"position\":{},\"group\":\"edges\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"strength\":66.28,\"color\":\"#3d3d3d\",\"style\":\"solid\",\"source\":\"21\",\"label\":\"403\",\"target\":\"19\",\"id\":\"275ec778-65bf-4675-ac35-ac6f4a599ff9\"},\"position\":{},\"group\":\"edges\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"strength\":67.93,\"color\":\"#3c3c3c\",\"style\":\"solid\",\"source\":\"22\",\"label\":\"413\",\"target\":\"11\",\"id\":\"493cb63d-3899-44d9-b2c0-ccea4295148d\"},\"position\":{},\"group\":\"edges\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"strength\":13.16,\"color\":\"#5c5c5c\",\"style\":\"solid\",\"source\":\"23\",\"label\":\"80\",\"target\":\"8\",\"id\":\"df55963b-0dc2-4c7f-aa56-0bedde183ba4\"},\"position\":{},\"group\":\"edges\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"strength\":4.28,\"color\":\"#616161\",\"style\":\"solid\",\"source\":\"24\",\"label\":\"26\",\"target\":\"18\",\"id\":\"3ca0de41-0f90-4b30-902a-ad6f522b70e0\"},\"position\":{},\"group\":\"edges\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"},{\"data\":{\"strength\":100,\"color\":\"#292929\",\"style\":\"dashed\",\"source\":\"26\",\"label\":\"608\",\"target\":\"12\",\"id\":\"bf6ba31a-bff9-451e-82e8-56692ab5f54b\"},\"position\":{},\"group\":\"edges\",\"removed\":false,\"selected\":false,\"selectable\":true,\"locked\":false,\"grabbable\":true,\"classes\":\"\"}]},\"style\":[{\"selector\":\"node\",\"style\":{\"text-valign\":\"center\",\"text-border-width\":\"10px\",\"text-wrap\":\"wrap\",\"text-max-width\":\"data(textwidth)\",\"font-size\":\"7px\",\"height\":\"data(height)\",\"width\":\"data(width)\",\"shape\":\"data(shape)\",\"background-color\":\"data(color)\",\"padding\":\"5px\",\"label\":\"data(name)\"}},{\"selector\":\":selected\",\"style\":{\"border-color\":\"#333\",\"border-width\":\"3px\"}},{\"selector\":\"edge\",\"style\":{\"label\":\"data(label)\",\"text-margin-y\":\"-10px\",\"color\":\"data(color)\",\"font-size\":\"7px\",\"opacity\":\"1\",\"width\":\"mapData(strength, 0, 100, 1, 6)\",\"line-style\":\"data(style)\",\"line-color\":\"data(color)\",\"curve-style\":\"bezier\",\"target-arrow-shape\":\"triangle\",\"source-arrow-color\":\"data(color)\",\"target-arrow-color\":\"data(color)\"}},{\"selector\":\"edge.questionable\",\"style\":{\"line-style\":\"dotted\",\"target-arrow-shape\":\"diamond\"}},{\"selector\":\".faded\",\"style\":{\"text-opacity\":\"0\",\"opacity\":\"0.25\"}},{\"selector\":\".edgebendediting-hasbendpoints\",\"style\":{\"curve-style\":\"segments\",\"segment-distances\":\"fn\",\"segment-weights\":\"fn\",\"edge-distances\":\"node-position\"}}],\"zoomingEnabled\":true,\"userZoomingEnabled\":true,\"zoom\":1,\"minZoom\":1.0E-50,\"maxZoom\":1.0E50,\"panningEnabled\":true,\"userPanningEnabled\":true,\"pan\":{\"x\":0,\"y\":0},\"boxSelectionEnabled\":true,\"renderer\":{\"name\":\"canvas\"},\"wheelSensitivity\":0.1}";

        BPMNUpdater bpmnUpdater = new BPMNUpdater();
        bpmnModel = bpmnUpdater.getUpdatedBPMN(bpmnModel, layout);

        System.out.println("Original BPMN");
        System.out.println(bpmnModel);

//        System.out.println("animationData");
//        System.out.println(animationData);
    }

    private String label = "Animate Logs";
    private String groupLabel = "Analyze";

    @Inject private EventLogService eventLogService;
    @Inject private LogAnimationService logAnimationService;
    @Inject private ProcessService processService;
    @Inject private ManagerService managerService;

    @Override
    public String getLabel(Locale locale) {
        return label;
    }

    public void setLabel(String label) {
        this.label = label;
    }

    @Override
    public String getGroupLabel(Locale locale) {
        return groupLabel;
    }

    public void setGroupLabel(String groupLabel) {
        this.groupLabel = groupLabel;
    }

    @Override
    public void execute(PortalContext portalContext) {

        List<Object[]> processes = new ArrayList<>();
        List<LogSummaryType> logSummaries = new ArrayList<>();

        Map<SummaryType, List<VersionSummaryType>> elements = portalContext.getSelection().getSelectedProcessModelVersions();
        for (SummaryType summary: elements.keySet()) {
            if (summary instanceof ProcessSummaryType) {
                for (VersionSummaryType version: elements.get(summary)) {
                    Object[] pair = { (ProcessSummaryType) summary, version };
                    processes.add(pair);
                }
            }
            else if (summary instanceof LogSummaryType) {
                logSummaries.add((LogSummaryType) summary);
            }
        }

        if (processes.size() != 1 || logSummaries.size() < 1) {
            Messagebox.show("Select exactly one BPMN model and at least one log", "Attention", Messagebox.OK, Messagebox.ERROR);
            return;
        }

        ProcessSummaryType process = (ProcessSummaryType) processes.get(0)[0];
        VersionSummaryType vst = (VersionSummaryType) processes.get(0)[1];

        // Fetch the BPMN serialization of the model
        int procID = process.getId();
        String procName = process.getName();
        String branch = vst.getName();
        Version version = new Version(vst.getVersionNumber());
        try {
            String bpmn = processService.getBPMNRepresentation(procName, procID, branch, version);

            // Fetch the XLog representations of the logs
            List<LogAnimationService.Log> logs = new ArrayList<>();
            Iterator<String> colors = Arrays.asList("#0088FF", "#FF8800", "#88FF00").iterator();
            for (LogSummaryType logSummary: logSummaries) {
                LogAnimationService.Log log = new LogAnimationService.Log();
                log.fileName = "Dummy";
                log.xlog     = eventLogService.getXLog(logSummary.getId());
                log.color    = colors.hasNext() ? colors.next() : "red";
                logs.add(log);
            }
            
            String username = portalContext.getCurrentUser().getUsername();
            EditSessionType editSession1 = createEditSession(username, process, vst, process.getOriginalNativeType(), null /*annotation*/);
            Set<RequestParameterType<?>> requestParameterTypes = new HashSet<>();
            SignavioSession session = new SignavioSession(editSession1, null, null, process, vst, null, null, requestParameterTypes);
            session.put("logAnimationService", logAnimationService);
            session.put("logs", logs);

            String id = UUID.randomUUID().toString();
            UserSessionManager.setEditSession(id, session);
            Clients.evalJavaScript("window.open('../loganimation/animateLogInSignavio.zul?id=" + id + "')");

        } catch (RepositoryException e) {
            Messagebox.show("Unable to read " + procName, "Attention", Messagebox.OK, Messagebox.ERROR);
            e.printStackTrace();
        }
    }

    @Override
    public void execute(PortalContext portalContext, String bpmn, String layout, XLog eventlog) {
        try {
            // Fetch the BPMN serialization of the model
//            int procID = processSummaryType.getId();
//            String procName = processSummaryType.getName();
//            String branch = versionSummaryType.getName();
//            Version version = new Version(versionSummaryType.getVersionNumber());

            // Fetch the XLog representations of the logs
            List<LogAnimationService.Log> logs = new ArrayList<>();
            Iterator<String> colors = Arrays.asList("#0088FF", "#FF8800", "#88FF00").iterator();
            LogAnimationService.Log log = new LogAnimationService.Log();
            log.fileName = "Dummy";
            log.xlog     = eventlog;
            log.color    = colors.hasNext() ? colors.next() : "red";
            logs.add(log);

            String username = portalContext.getCurrentUser().getUsername();

            ProcessSummaryType processSummaryType = new ProcessSummaryType();
            processSummaryType.setDomain("Log-Visualizer");
            processSummaryType.setName("Log-Visualizer-Model");
            processSummaryType.setId(1);
            processSummaryType.setMakePublic(true);

            VersionSummaryType versionSummaryType = new VersionSummaryType();
            versionSummaryType.setName("Log-Visualizer-Model");
            versionSummaryType.setVersionNumber("1.0");

            EditSessionType editSession = createEditSession(username, processSummaryType, versionSummaryType, "BPMN 2.0", null);
            Set<RequestParameterType<?>> requestParameterTypes = new HashSet<>();
            SignavioSession session = new SignavioSession(editSession, null, null, processSummaryType, versionSummaryType, null, null, requestParameterTypes);

//            SignavioSession session = new SignavioSession(null, null, null, null, null, null, null, requestParameterTypes);

//            String username = portalContext.getCurrentUser().getUsername();
////            EditSessionType editSession = createEditSession(username, processSummaryType, versionSummaryType, processSummaryType.getOriginalNativeType(), null /*annotation*/);
//            Set<RequestParameterType<?>> requestParameterTypes = new HashSet<>();
////            SignavioSession session = new SignavioSession(editSession, null, null, processSummaryType, versionSummaryType, null, null, requestParameterTypes);
//            SignavioSession session = new SignavioSession(null, null, null, null, null, null, null, requestParameterTypes);

//            ExportFormatResultType exportResult1 = managerService.exportFormat(
//                                                    editSession.getProcessId(),
//                                                    editSession.getProcessName(),
//                                                    editSession.getOriginalBranchName(),
//                                                    editSession.getCurrentVersionNumber(),
//                                                    editSession.getNativeType(),
//                                                    editSession.getAnnotation(),
//                                                    editSession.isWithAnnotation(),
//                                                    editSession.getUsername(),
//                                                    session.getParams());

//            String jsonData = StreamUtil.convertStreamToString(exportResult1.getNative().getInputStream());

            String jsonDataEscape = escapeQuotedJavascript(bpmn);

            System.out.println("Initial BPMN");
//            System.out.println(jsonDataEscape);

            System.out.println("Cytoscape Layout");
//            System.out.println(layout);

            BPMNUpdater bpmnUpdater = new BPMNUpdater();
            jsonDataEscape = bpmnUpdater.getUpdatedBPMN(jsonDataEscape, layout);

            System.out.println("Final BPMN");
//            System.out.println(jsonDataEscape);
            session.put("JSONData", jsonDataEscape);

            if (logAnimationService != null) {  // logAnimationService is null if invoked from the editor toobar
                String animationData = logAnimationService.createAnimation(bpmn, logs);

                AnimationUpdater animationUpdater = new AnimationUpdater();
                animationData = animationUpdater.updateAnimationData(animationData, bpmnUpdater.getRemovedFlowIDs());

                session.put("animationData", escapeQuotedJavascript(animationData));
                System.out.println("ANIMATIONDATA");
//                System.out.println(escapeQuotedJavascript(animationData));
            }

            session.put("logs", logs);

            String id = UUID.randomUUID().toString();
            UserSessionManager.setEditSession(id, session);
            Clients.evalJavaScript("window.open('../loganimation/animateLogInSignavio.zul?id=" + id + "')");
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    private static EditSessionType createEditSession(final String username, final ProcessSummaryType process, final VersionSummaryType version, final String nativeType, final String annotation) {

        EditSessionType editSession = new EditSessionType();

        editSession.setDomain(process.getDomain());
        editSession.setNativeType(nativeType.equals("XPDL 2.2")?"BPMN 2.0":nativeType);
        editSession.setProcessId(process.getId());
        editSession.setProcessName(process.getName());
        editSession.setUsername(username);
        editSession.setPublicModel(process.isMakePublic());
        editSession.setOriginalBranchName(version.getName());
        editSession.setOriginalVersionNumber(version.getVersionNumber());
        editSession.setCurrentVersionNumber(version.getVersionNumber());
        editSession.setMaxVersionNumber(findMaxVersion(process));

        editSession.setCreationDate(version.getCreationDate());
        editSession.setLastUpdate(version.getLastUpdate());
        if (annotation == null) {
            editSession.setWithAnnotation(false);
        } else {
            editSession.setWithAnnotation(true);
            editSession.setAnnotation(annotation);
        }

        return editSession;
    }

    /* From a list of version summary types find the max version number. */
    private static String findMaxVersion(ProcessSummaryType process) {
        Version versionNum;
        Version max = new Version(0, 0);
        for (VersionSummaryType version : process.getVersionSummaries()) {
            versionNum = new Version(version.getVersionNumber());
            if (versionNum.compareTo(max) > 0) {
                max = versionNum;
            }
        }
        return max.toString();
    }

    /**
     * @param json
     * @return the <var>json</var> escaped so that it can be quoted in Javascript.
     *     Specifically, it replaces apostrophes with \\u0027 and removes embedded newlines and leading and trailing whitespace.
     */
    private static String escapeQuotedJavascript(String json) {
        return json.replace("\n", " ").replace("'", "\\u0027").trim();
    }
}
